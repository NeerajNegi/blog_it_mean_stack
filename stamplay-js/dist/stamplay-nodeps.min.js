/*! Stamplay v2.1.4 | (c) 2016 Stamplay */
!function(a){"use strict";function b(b){return decodeURIComponent((new RegExp("[?|&]"+b+"=([^&;]+?)(&|#|;|$)").exec(a.location.search)||[,""])[1].replace(/\+/g,"%20"))||null}a.Stamplay=a.Stamplay||{},a.Stamplay.VERSION="v1",a.Stamplay.APPID="",a.Stamplay.BASEURL="",a.Stamplay.OPTIONS={},a.localStorage&&store.enabled&&(a.Stamplay.USESTORAGE=!0),b("jwt")&&a.Stamplay.USESTORAGE&&store.set(a.location.origin+"-jwt",b("jwt")),a.Stamplay.init=function(b,c){a.Stamplay.BASEURL="https://"+b+".stamplayapp.com",a.Stamplay.APPID=b,a.Stamplay.OPTIONS=c||{}},a.Stamplay.isString=function(a){return"string"==typeof a||!!a&&"object"==typeof a&&"[object String]"===Object.prototype.toString.call(a)},a.Stamplay.isNumber=function(a){return"number"==typeof a||!isNaN(parseFloat(a))&&isFinite(a)},a.Stamplay.isFunction=function(a){return a&&"[object Function]"==={}.toString.call(a)},a.Stamplay.isObject=function(a){return!!a&&"object"==typeof a},a.Stamplay.extend=function(a,b){var c,d,e=Object.keys(b),f=e.length;for(c=0;f>c;++c)d=e[c],a[d]=b[d];return a}}(this),function(a){"use strict";function b(b,c,d){if(Object.keys(d.headers||{}).forEach(function(a){c.setRequestHeader(a,d.headers[a])}),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Accept","application/json, text/plain"),c.setRequestHeader("stamplay-app",b),a.Stamplay.USESTORAGE){var e=store.get(a.location.origin+"-jwt");e&&(g(e)?c.setRequestHeader("x-stamplay-jwt",e):store.remove(a.location.origin+"-jwt"))}}function c(b){var c=b.getResponseHeader("x-stamplay-jwt");if(c){var e=d(c);a.Stamplay.USESTORAGE&&store.set(a.location.origin+"-jwt",c)}return e}function d(a){var b={},c={},d="";try{var f=a.split(".");b=JSON.parse(e(f[0]||"{}")),c=JSON.parse(e(f[1]||"{}")),d=f[2]}catch(g){}return{header:b,claims:c,signature:d}}function e(a){return"undefined"!=typeof atob?atob(a):f(a)}function f(a){var b,c,d,e,f={},g=0,h=0,i="",j=String.fromCharCode,k=a.length,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(b=0;64>b;b++)f[l.charAt(b)]=b;for(d=0;k>d;d++)for(c=f[a.charAt(d)],g=(g<<6)+c,h+=6;h>=8;)((e=g>>>(h-=8)&255)||k-2>d)&&(i+=j(e));return i}function g(a){var b,c,e=d(a).claims,f=Math.floor((new Date).getTime()/1e3);if("object"==typeof e){if(e.hasOwnProperty("iat")){b=e.iat;var g=3e4,h=new Date(1e3*b),i=new Date(h-g);b=i.getTime()/1e3}c=e.hasOwnProperty("exp")?e.exp:b+86400}return f&&b&&c&&f>=b&&c>=f}var h=function(a){for(var b=Object.keys(a.thisParams),c=0;c<b.length;c++){var d=c>0?"&":"?",e=b[c];a.url=a.url+d+e+"="+a.thisParams[e]}};a.Stamplay.makeAPromise=function(d,e){d.thisParams&&h(d);var f=a.Stamplay.APPID;""!=a.Stamplay.APPID?d.url=a.Stamplay.BASEURL+d.url:(f=location.host,f=f.replace(/^www\./,""),f=f.replace(/:[0-9]*$/g,""));var g=new XMLHttpRequest;g.open(d.method||"GET",d.url,d.async||!0),b(f,g,d);var i=Q.defer();return g.onreadystatechange=function(){4==g.readyState&&(-1===[200,304].indexOf(g.status)?i.reject({code:g.status,message:g.responseText}):(c(g),i.resolve(JSON.parse(g.responseText))),i.promise.nodeify(e))},g.send(JSON.stringify(d.data)||void 0),i.promise}}(this),function(a){"use strict";function b(b,c){var d=function(a,b){switch(a){case"cobject":delete b.__v,delete b.cobjectId,delete b.actions,delete b.appId,delete b.id;break;case"user":delete b._id,delete b.id,delete b.__v}},e=function(b,c,d,e,f,g){var h={method:d,url:"/api/"+b+"/"+a.Stamplay.VERSION+"/"+c};return e&&(h.url=h.url+"/"+e),f&&"GET"!=d&&(h.data=f),"GET"==d&&(h.thisParams=f),a.Stamplay.makeAPromise(h,g)};return{brickId:b,resourceId:c,get:function(a,b){return e(this.brickId,this.resourceId,"GET",!1,a,b)},getById:function(a,b,c){return e(this.brickId,this.resourceId,"GET",a,b,c)},save:function(a,b){return e(this.brickId,this.resourceId,"POST",!1,a,b)},patch:function(a,b,c){return d(this.brickId,b),e(this.brickId,this.resourceId,"PATCH",a,b,c)},update:function(a,b,c){return d(this.brickId,b),e(this.brickId,this.resourceId,"PUT",a,b,c)},remove:function(a,b){return e(this.brickId,this.resourceId,"DELETE",a,!1,b)}}}a.Stamplay.BaseComponent=b}(this),function(a){"use strict";function b(){this.redirect=function(b){a.location.href=b},this.validateEmail=function(b,c){return a.Stamplay.makeAPromise({method:"POST",data:{email:b},url:"/api/auth/"+a.Stamplay.VERSION+"/validate/email"},c)}}var c=new b;a.Stamplay.Support=c}(this),function(a){"use strict";function b(a,b,c,d,e,f){var g={_geolocation:{}};return g._geolocation[a]={},g._geolocation[a][b]={type:c,coordinates:d},e&&(g._geolocation[a].$maxDistance=e),f&&(g._geolocation[a].$minDistance=f),g}function c(a,b){var c={_geolocation:{$geoWithin:{}}};return c._geolocation.$geoWithin[a]=b,c}function d(d,e){return{model:d,instance:e,paginationQuery:"",sortQuery:"",selectionQuery:"",populateQuery:"",populateOwnerQuery:"",whereQuery:[],executable:"",or:function(){var a={$or:[]},b=arguments;arguments[0]instanceof Array&&(b=arguments[0]);for(var c=0;c<b.length;c++){if(!b[c].whereQuery)throw new Error("Please Or function take only Query object");a.$or.push(b[c].whereQuery[0])}return this.whereQuery.push(a),this},pagination:function(a,b){return this.paginationQuery="&page="+a+"&per_page="+b,this},between:function(a,b,c){var d={};return d[a]={$gte:b,$lte:c},this.whereQuery.push(d),this},greaterThan:function(a,b){var c={};return c[a]={$gt:b},this.whereQuery.push(c),this},greaterThanOrEqual:function(a,b){var c={};return c[a]={$gte:b},this.whereQuery.push(c),this},lessThan:function(a,b){var c={};return c[a]={$lt:b},this.whereQuery.push(c),this},lessThanOrEqual:function(a,b){var c={};return c[a]={$lte:b},this.whereQuery.push(c),this},equalTo:function(a,b){var c={};return c[a]=b,this.whereQuery.push(c),this},notEqualTo:function(a,b){var c={};return c[a]={$ne:b},this.whereQuery.push(c),this},sortAscending:function(a){return this.sortQuery="&sort="+a,this},sortDescending:function(a){return this.sortQuery="&sort=-"+a,this},exists:function(a){var b={};return b[a]={$exists:!0},this.whereQuery.push(b),this},notExists:function(a){var b={};return b[a]={$exists:!1},this.whereQuery.push(b),this},regex:function(a,b,c){var d={};return d[a]={$regex:b,$options:c},this.whereQuery.push(d),this},populate:function(){return this.populateQuery="&populate=true",this},populateOwner:function(){return this.populateOwnerQuery="&populate_owner=true",this},select:function(){return this.selectionQuery="&select="+Array.prototype.slice.call(arguments).join(", ").replace(" ",""),this},near:function(a,c,d,e){var f=b("$near","$geometry",a,c,d,e);return this.whereQuery.push(f),this},nearSphere:function(a,c,d,e){var f=b("$nearSphere","$geometry",a,c,d,e);return this.whereQuery.push(f),this},geoIntersects:function(a,c){var d=b("$geoIntersects","$geometry",a,c);return this.whereQuery.push(d),this},geoWithinGeometry:function(a,c){var d=b("$geoWithin","$geometry",a,c);return this.whereQuery.push(d),this},geoWithinCenterSphere:function(a,b){var d=[a,b],e=c("$centerSphere",d);return this.whereQuery.push(e),this},exec:function(b){for(var c=0;c<this.whereQuery.length;c++){var d=JSON.stringify(this.whereQuery[c]);d=d.substring(1,d.length-1),0===c?this.executable+=d:this.executable+=","+d}switch(this.model){case"object":this.model="cobject";break;default:this.instance="users"}var e="/api/"+this.model+"/"+a.Stamplay.VERSION+"/"+this.instance+"?where={"+this.executable+"}"+this.paginationQuery+this.selectionQuery+this.sortQuery+this.populateQuery+this.populateOwnerQuery;return a.Stamplay.makeAPromise({method:"GET",url:e},b)}}}a.Stamplay.Query=d}(this),function(a){"use strict";var b={brickId:"user",resourceId:"users",currentUser:function(b){return a.Stamplay.makeAPromise({method:"GET",url:"/api/"+this.brickId+"/"+a.Stamplay.VERSION+"/getStatus"},b)},login:function(b,c){return a.Stamplay.makeAPromise({method:"POST",data:b,url:"/auth/"+a.Stamplay.VERSION+"/local/login"},c)},socialLogin:function(b){if(!b)throw new Error("Stamplay.User.socialLogin needs the service name");var c="/auth/"+a.Stamplay.VERSION+"/"+b+"/connect";if(a.Stamplay.OPTIONS.isMobile){var d=a.open(a.Stamplay.BASEURL+c,"socialLogin","left=1,top=1,width=600,height=600");d.addEventListener("loadstart",function(b){var c=new RegExp("jwt=([A-Za-z0-9-_=]+.[A-Za-z0-9-_=]+.[A-Za-z0-9-_.+=]+)");if(b.url.indexOf("jwt=")>-1){var e=b.url.match(c)[1];store.set(a.location.origin+"-jwt",e),a.Stamplay.OPTIONS.autoRefreshSocialLogin&&location.reload(),d.close()}})}else{var e=store.get(a.location.origin+"-jwt");if(e){var f=new Date;f.setTime(f.getTime()+3e5),a.document.cookie="stamplay.jwt="+e+"; expires="+f.toGMTString()+"; path=/"}var g=a.location.port?":"+a.location.port:"",h=location.protocol+"//"+a.document.domain+g+c;a.Stamplay.OPTIONS.absoluteUrl&&(h=a.Stamplay.BASEURL+c),a.Stamplay.Support.redirect(h)}},signup:function(b,c){return a.Stamplay.makeAPromise({method:"POST",data:b,url:"/api/"+this.brickId+"/"+a.Stamplay.VERSION+"/"+this.resourceId},c)},logout:function(b,c){var d=store.get(a.location.origin+"-jwt");if(a.Stamplay.USESTORAGE&&store.remove(a.location.origin+"-jwt"),b)return a.Stamplay.makeAPromise({method:"GET",url:"/auth/"+a.Stamplay.VERSION+"/logout?jwt="+d},c);var e="/auth/"+a.Stamplay.VERSION+"/logout?jwt="+d,f=a.location.port?":"+a.location.port:"",g=location.protocol+"//"+a.document.domain+f+e;a.Stamplay.OPTIONS.absoluteUrl&&(g=a.Stamplay.BASEURL+e),a.Stamplay.Support.redirect(g)},resetPassword:function(b,c){return a.Stamplay.makeAPromise({method:"POST",data:b,url:"/api/"+this.brickId+"/"+a.Stamplay.VERSION+"/users/resetpassword"},c)},getRoles:function(b){return a.Stamplay.makeAPromise({method:"GET",url:"/api/user/"+a.Stamplay.VERSION+"/roles"},b)},getRole:function(b,c){return a.Stamplay.makeAPromise({method:"GET",url:"/api/user/"+a.Stamplay.VERSION+"/roles/"+b},c)},setRole:function(b,c,d){return a.Stamplay.makeAPromise({method:"PATCH",data:{givenRole:c},url:"/api/user/"+a.Stamplay.VERSION+"/users/"+b+"/role"},d)}};a.Stamplay.extend(b,a.Stamplay.BaseComponent(b.brickId,b.resourceId)),delete b.patch,b.remove=function(b,c){return a.Stamplay.makeAPromise({method:"DELETE",url:"/api/"+this.brickId+"/"+a.Stamplay.VERSION+"/"+this.resourceId+"/"+b},c).then(function(b){if(a.Stamplay.USESTORAGE){var c=store.get(a.location.origin+"-jwt");c&&store.remove(a.location.origin+"-jwt")}})},a.Stamplay.User=b}(this),function(a){"use strict";function b(b){if(b)return a.Stamplay.extend({brickId:"cobject",resourceId:b,findByCurrentUser:function(b,c,d){var e,f="owner",g={};return 3===arguments.length?(f=b,g=c,e=d):2===arguments.length?a.Stamplay.isFunction(arguments[1])?(e=arguments[1],f=a.Stamplay.isString(arguments[0])?arguments[0]:"owner",g=a.Stamplay.isObject(arguments[0])?arguments[0]:{}):(f=arguments[0],g=arguments[1]):1===arguments.length&&(a.Stamplay.isFunction(arguments[0])?e=arguments[0]:(f=a.Stamplay.isString(arguments[0])?arguments[0]:"owner",g=a.Stamplay.isObject(arguments[0])?arguments[0]:{})),a.Stamplay.makeAPromise({method:"GET",thisParams:g,url:"/api/"+this.brickId+"/"+a.Stamplay.VERSION+"/"+this.resourceId+"/find/"+f},e)},upVote:function(a,b){return c.call(this,a,"vote",{type:"upvote"},b)},downVote:function(a,b){return c.call(this,a,"vote",{type:"downvote"},b)},rate:function(a,b,d){return c.call(this,a,"rate",{rate:b},d)},comment:function(a,b,d){return c.call(this,a,"comment",{text:b},d)},push:function(a,c,g,h){return h?d(b,a).then(function(d){var i=f(d,c,g);return e(b,a,i,h)},function(a){h(a,null)}).fail(function(a){h(a,null)}):d(b,a).then(function(d){var h=f(d,c,g);return e(b,a,h)})}},a.Stamplay.BaseComponent("cobject",b));throw new Error("Stamplay.Object(objecId) needs a objectId")}var c=function(b,c,d,e){return a.Stamplay.makeAPromise({method:"PUT",data:d?d:{},url:"/api/"+this.brickId+"/"+a.Stamplay.VERSION+"/"+this.resourceId+"/"+b+"/"+c},e)},d=function(b,c){return a.Stamplay.BaseComponent("cobject",b+"/"+c).get()},e=function(b,c,d,e){return a.Stamplay.BaseComponent("cobject",b).patch(c,d,e)},f=function(a,b,c){var d={};return d[b]=a[b]||[],d[b].push(c),d};a.Stamplay.Object=b}(this),function(a){"use strict";function b(b){var c=b.replace(/[^\w\s]/gi,"").trim().toLowerCase().replace(/\s+/g,"_"),d="/api/webhook/"+a.Stamplay.VERSION+"/"+c+"/catch";return{post:function(b,c){return a.Stamplay.makeAPromise({method:"POST",data:b,url:d},c)}}}a.Stamplay.Webhook=b}(this),function(a){"use strict";var b={url:"/api/stripe/"+a.Stamplay.VERSION+"/",createCustomer:function(b,c){return a.Stamplay.makeAPromise({method:"POST",data:{userId:b},url:this.url+"customers"},c)},createCreditCard:function(b,c,d){if(arguments.length>=2&&a.Stamplay.isString(arguments[0])&&a.Stamplay.isString(arguments[1]))return a.Stamplay.makeAPromise({method:"POST",data:{token:c},url:this.url+"customers/"+b+"/cards"},d);throw new Error("Stamplay.Stripe.createCustomer:  missing parameters")},updateCreditCard:function(b,c,d){if(arguments.length>=2&&a.Stamplay.isString(arguments[0])&&a.Stamplay.isString(arguments[1]))return a.Stamplay.makeAPromise({method:"PUT",data:{token:c},url:this.url+"customers/"+b+"/cards"},d);throw new Error("Stamplay.Stripe.updateCreditCard:  missing parameters")},charge:function(b,c,d,e,f){if(arguments.length>=4&&a.Stamplay.isString(arguments[0])&&a.Stamplay.isString(arguments[1])&&a.Stamplay.isNumber(arguments[2])&&a.Stamplay.isString(arguments[3]))return a.Stamplay.makeAPromise({method:"POST",data:{userId:b,token:c,amount:d,currency:e},url:this.url+"charges"},f);throw new Error("Stamplay.Stripe.charge:  missing or incorrect parameters")},createSubscription:function(b,c,d){if(arguments.length>=2&&a.Stamplay.isString(arguments[0])&&a.Stamplay.isString(arguments[1]))return a.Stamplay.makeAPromise({method:"POST",data:{planId:c},url:this.url+"customers/"+b+"/subscriptions"},d);throw new Error("Stamplay.Stripe.createSubscription:  missing parameters")},getSubscriptions:function(b,c,d){if(arguments.length>=2)return a.Stamplay.makeAPromise({method:"GET",url:this.url+"customers/"+b+"/subscriptions",thisParams:c},d);throw new Error("Stamplay.Stripe.getSubscriptions:  missing parameters")},getSubscription:function(b,c,d){if(arguments.length>=2&&a.Stamplay.isString(arguments[0])&&a.Stamplay.isString(arguments[1]))return a.Stamplay.makeAPromise({method:"GET",url:this.url+"customers/"+b+"/subscriptions/"+c},d);throw new Error("Stamplay.Stripe.getSubscription:  missing parameters")},getCreditCard:function(b,c){return a.Stamplay.makeAPromise({method:"GET",url:this.url+"customers/"+b+"/cards"},c)},deleteSubscription:function(b,c,d,e){if(arguments.length>=3)return a.Stamplay.makeAPromise({method:"DELETE",url:this.url+"customers/"+b+"/subscriptions/"+c,data:d},e);throw new Error("Stamplay.Stripe.deleteSubscription:  missing parameters")},updateSubscription:function(b,c,d,e){if(arguments.length>=3)return a.Stamplay.makeAPromise({method:"PUT",url:this.url+"customers/"+b+"/subscriptions/"+c,data:{options:d}},e);throw new Error("Stamplay.Stripe.updateSubscription:  missing parameters")}};a.Stamplay.Stripe=b}(this),function(a){"use strict";function b(b,c,d,e,f){return a.Stamplay.makeAPromise({method:b,data:d,url:c,thisParams:e},f)}function c(c){var d=c.replace(/[^\w\s]/gi,"").trim().toLowerCase().replace(/\s+/g,"_"),e="/api/codeblock/"+a.Stamplay.VERSION+"/run/"+d;return{run:function(a,c,d){return b("POST",e,a,c,d)},post:function(a,c,d){return b("POST",e,a,c,d)},get:function(a,c){return b("GET",e,null,a,c)},put:function(a,c,d){return b("PUT",e,a,c,d)},patch:function(a,c,d){return b("PATCH",e,a,c,d)},"delete":function(a,c){return b("DELETE",e,null,a,c)}}}a.Stamplay.Codeblock=c}(this);
//# sourceMappingURL=stamplay-nodeps.min.js.map